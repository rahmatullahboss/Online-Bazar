# AI Rules

## Tech Stack Overview

- **Frontend Framework**: Next.js 15 with React 19 and TypeScript for type-safe development
- **Backend/CMS**: Payload CMS 3.0 for content management, authentication, and API generation
- **Database**: Neon Database with automatic schema management via Payload migrations
- **UI Components**: shadcn/ui components with Radix UI primitives for accessible, customizable components
- **Styling**: Tailwind CSS for utility-first styling with custom design system
- **Authentication**: Built-in Payload authentication with role-based access control (user/admin roles)
- **State Management**: React Context API for cart functionality, built-in Payload state for CMS data
- **Image Handling**: Next.js Image component with Sharp for optimization, Payload Media collection for uploads
- **Form Handling**: React Hook Form with Zod validation for type-safe form management

## Access Control Rules

### Core Security Principles
1. **Least Privilege**: Grant minimum required access
2. **Deny by Default**: Explicitly grant permissions
3. **Defense in Depth**: Multiple security layers
4. **Never Trust Client Data**: Always validate server-side

## File Structure Rules

### Never Modify These Files
- **`src/payload-types.ts`** - Auto-generated by Payload, will be overwritten
- **`src/migrations/`** - Database migration files, only modify if you understand the consequences

### File Organization
- **Components**: Place reusable components in `src/components/`
- **UI Components**: Keep shadcn/ui components in `src/components/ui/`
- **Pages**: Use Next.js app router structure in `src/app/(frontend)/`
- **Collections**: Define Payload collections in `src/collections/`
- **API Routes**: Custom API routes in `src/app/api/`
- **Utilities**: Helper functions in `src/lib/`

## Development Best Practices

### Authentication & Security
- **Always check user authentication** before allowing access to protected resources
- **Use Payload's built-in auth methods** (`payload.auth()`) to get current user
- **Validate user roles** using the `checkRole` utility from `src/collections/access/`
- **Never trust client-side data** - always validate on the server

### Database Operations
- **Use Payload's Local API** for server-side database operations
- **Use proper TypeScript types** from payload-types.ts for type safety
- **Handle relationships properly** using Payload's depth parameter
- **Use transactions** for operations that modify multiple collections

### Error Handling
- **Always handle errors gracefully** with user-friendly messages
- **Use try-catch blocks** for async operations
- **Return proper HTTP status codes** in API routes
- **Log errors** for debugging but don't expose sensitive information to users

## Code Style Guidelines

### TypeScript
- **Always use TypeScript** - no plain JavaScript files
- **Use proper type definitions** from payload-types.ts
- **Define interfaces** for component props and custom types
- **Use type assertions sparingly** and prefer type guards

### React Patterns
- **Use functional components** with hooks
- **Implement proper error boundaries** for production apps
- **Use React.Suspense** for loading states when appropriate
- **Follow React best practices** for component composition

## Library Usage Rules

### UI Components
- **ALWAYS use shadcn/ui components** from `@/components/ui/` for consistent design
- **Use Radix UI primitives** when shadcn/ui doesn't have the needed component
- **Use Lucide React** for all icons (`lucide-react` package)
- **Never install additional UI libraries** without justification

### Styling
- **ALWAYS use Tailwind CSS** for styling - no custom CSS files except globals.css
- **Use Tailwind utility classes** extensively for responsive design
- **Follow the existing color scheme** unless instructed otherwise
- **Use the predefined CSS custom properties** in globals.css for consistent theming

### State Management
- **Use React Context** for global client-side state
- **Use Payload's built-in state** for CMS data and authentication
- **Use React useState/useReducer** for local component state

## Integration Rules

### Payload CMS Integration
- **Use Payload's built-in features** before building custom solutions
- **Leverage Payload's access control system** instead of custom middleware
- **Use Payload's hooks** for data transformation and validation
- **Follow Payload's collection configuration patterns**

Remember: This is a production application handling user data and orders. Always prioritize security, user experience, and data integrity in your implementations.
